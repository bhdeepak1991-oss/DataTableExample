@{
    ViewData["Title"] = "Employee Management";
}

<!-- Bootstrap -->
<link rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />

<!-- Bootstrap Icons -->
<link rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">

<div class="container-fluid mt-4">

    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h4 class="fw-semibold">Employee List</h4>
        <button class="btn btn-primary btn-sm">Add Employee</button>
    </div>

    <!-- Search & Page Size -->
    <div class="row mb-2 align-items-center">
        <div class="col-md-4">
            <input type="text" id="txtSearch" class="form-control form-control-sm"
                   placeholder="Search..." />
        </div>

        <div class="col-md-2 ms-auto text-end">
            <select id="ddlPageSize" class="form-select form-select-sm">
                <option value="5">5</option>
                <option value="10" selected>10</option>
                <option value="25">25</option>
                <option value="50">50</option>
            </select>
        </div>
    </div>

    <!-- Table -->
    <div class="card shadow-sm">
        <div class="table-responsive">
            <table class="table table-bordered table-hover mb-0">
                <thead class="table-light">
                    <tr>
                        <th onclick="sort('Id')">Id <i id="sort-Id" class="bi bi-arrow-down-up ms-1"></i></th>
                        <th onclick="sort('FirstName')">First Name <i id="sort-FirstName" class="bi bi-arrow-down-up ms-1"></i></th>
                        <th onclick="sort('MiddleName')">Middle Name <i id="sort-MiddleName" class="bi bi-arrow-down-up ms-1"></i></th>
                        <th onclick="sort('LastName')">Last Name <i id="sort-LastName" class="bi bi-arrow-down-up ms-1"></i></th>
                        <th onclick="sort('EmailId')">Email <i id="sort-EmailId" class="bi bi-arrow-down-up ms-1"></i></th>
                    </tr>
                </thead>
                <tbody id="tblBody"></tbody>
            </table>
        </div>
    </div>

    <!-- Pagination -->
    <div class="d-flex justify-content-between align-items-center mt-2">
        <small id="pageInfo"></small>
        <ul class="pagination pagination-sm mb-0" id="pagination"></ul>
    </div>

</div>

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

<script>
    let page = 1;
    let pageSize = 10;
    let sortColumn = "Id";
    let sortDirection = "ASC";
    let searchText = "";

    $(document).ready(function () {
        loadData();

        $("#txtSearch").on("keyup", function () {
            searchText = $(this).val();
            page = 1;
            loadData();
        });

        $("#ddlPageSize").on("change", function () {
            pageSize = parseInt($(this).val());
            page = 1;
            loadData();
        });
    });

    function sort(column) {
        if (sortColumn === column) {
            sortDirection = sortDirection === "ASC" ? "DESC" : "ASC";
        } else {
            sortColumn = column;
            sortDirection = "ASC";
        }
        updateSortIcons();
        loadData();
    }

    function updateSortIcons() {
        $("i[id^='sort-']").removeClass("bi-sort-up bi-sort-down")
                            .addClass("bi-arrow-down-up");

        const icon = $("#sort-" + sortColumn);
        icon.removeClass("bi-arrow-down-up");

        sortDirection === "ASC"
            ? icon.addClass("bi-sort-up")
            : icon.addClass("bi-sort-down");
    }

    function loadData() {
        $("#tblBody").html('<tr><td colspan="5">Loading...</td></tr>');

        $.post("/Home/AspCoreTableDetail", {
            PageIndex: page,
            PageSize: pageSize,
            SortColumn: sortColumn,
            SortDirection: sortDirection,
            SearchText: searchText
        }, function (response) {
            $("#tblBody").html(response.html);
            renderPagination(response.filteredRecords);
        });
    }

    function renderPagination(totalRecords) {
        const totalPages = Math.ceil(totalRecords / pageSize);
        const maxVisiblePages = 5;
        $("#pagination").empty();

        if (totalPages === 0) {
            $("#pageInfo").text("No records found");
            return;
        }

        $("#pageInfo").text(`Page ${page} of ${totalPages}`);

        addNav("Prev", page - 1, page === 1);

        let start = Math.max(1, page - Math.floor(maxVisiblePages / 2));
        let end = Math.min(totalPages, start + maxVisiblePages - 1);

        if (start > 1) {
            addPage(1);
            if (start > 2) addDots();
        }

        for (let i = start; i <= end; i++) {
            addPage(i, i === page);
        }

        if (end < totalPages) {
            if (end < totalPages - 1) addDots();
            addPage(totalPages);
        }

        addNav("Next", page + 1, page === totalPages);
    }

    function addPage(p, active = false) {
        $("#pagination").append(`
            <li class="page-item ${active ? 'active' : ''}">
                <a class="page-link" href="#" onclick="goToPage(${p})">${p}</a>
            </li>
        `);
    }

    function addNav(text, p, disabled) {
        $("#pagination").append(`
            <li class="page-item ${disabled ? 'disabled' : ''}">
                <a class="page-link" href="#" onclick="goToPage(${p})">${text}</a>
            </li>
        `);
    }

    function addDots() {
        $("#pagination").append(`
            <li class="page-item disabled">
                <span class="page-link">...</span>
            </li>
        `);
    }

    function goToPage(p) {
        if (p < 1) return;
        page = p;
        loadData();
    }
</script>
